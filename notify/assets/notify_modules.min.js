!function(t){var e,o,n,i,r,a={getNumberInCounter:function(){return parseInt(i.text())},updateCounter:function(t){var e=a.getNumberInCounter();0>=t&&o.hasClass("active")&&o.removeClass("active"),e!=t&&i.text(t)},checkNew:function(){if("undefined"==typeof e.notifyUrlUpdate||null===e.notifyUrlUpdate)return console.error('variable "settings.notifyUrlUpdate" need be installed'),this;var r=function(){var r=o,u=i,s=parseInt(u.text());t.ajax({type:"POST",dataType:"json",url:e.notifyUrlUpdate,data:{count:s?s:0},global:!1,success:function(t){t&&(s!=t.count||t.update)&&(u.text(t.count),0!=t.count||t.update?(r.addClass("active"),u.effect("bounce",{times:5},1500),n.find(".popover-content").html(t.content)):0==t.count&&a.updateCounter(0),a.auto_height(!0))}})};return setInterval(r,e.notifyTimeUpdate),this},show:function(){return n.filter(".popover").fadeToggle(200,function(){n.is(":visible")?r=setTimeout(function(){var o=[];n.find(".notify:not(.read)").each(function(){o.push(t(this).data("id"))}),e.notifyUrlRead&&o.length>0&&t.post(e.notifyUrlRead,{ids:o},function(e){e&&t.each(e,function(t,e){1==parseInt(e,10)&&(n.find('[data-id="'+t+'"]').addClass("read"),a.updateCounter(a.getNumberInCounter()-1))})},"json")},1e3):clearTimeout(r)}),a.auto_width(),a.auto_height(),a.auto_position(),this},auto_height:function(o){var i=o||!1,r=n.find(".popover-content");i&&(r.css({height:"auto"}),n.data("default-height",!1));var a=r.children().first().outerHeight(),u=(r.find(e.selector_notify_message).first()||r.find(".no_notify")).outerHeight(),s=n.data("default-height");s||(s=n.outerHeight(),n.data("default-height",s)),s+=n.offset().top;var f=t("body").height();if(s>f?r.css({height:a-(s-f)}):f>s&&r.css({height:a}),u&&r.outerHeight()<u){var c=r.children().children().length;r.css({height:u*(c<=e.min_count_show?c:e.min_count_show)})}},auto_position:function(){var e=o.position(),i=-4,r=n.outerWidth()/2-o.width()/2-i;n.css({top:e.top+o.outerHeight()-9,left:"-"+r+"px"});var a=n.outerWidth()+n.offset().left-t("body").outerWidth();n.css({left:"-"+(r+(a>0?a:0))+"px"}),n.find(".arrow").css({left:n.outerWidth()/2+(a>0?Math.ceil(a):0)-i+"px"})},auto_width:function(){n.outerWidth()>t("body").outerWidth()&&n.css({"min-width":t("body").outerWidth()+"px"})},init:function(r){return this.data("notifyCenter")?this:(e=t.extend({selector_notify_button:".notify_button",selector_notify_content:".notify_content",selector_notify_counter:".notify_button .count",selector_notify_message:".notify",notifyTimeUpdate:15e3,notifyUrlUpdate:null,notifyUrlRead:null,min_count_show:3},r),o=t(e.selector_notify_button),n=t(e.selector_notify_content),i=t(e.selector_notify_counter),o.click(function(t){t.preventDefault(),a.show()}),t(document).bind("click",function(e){var i=t(e.target);i.closest(o).length||i.closest(n).length||n.filter(".popover").fadeOut(200)}),t(window).resize(function(){a.auto_width(),a.auto_height(),a.auto_position()}),u.saveProperties(),this)}},u={saveProperties:function(){t(this).data("notifyCenter",e)},loadProperties:function(){t(this).data("notifyCenter")&&(e=t(this).data("notifyCenter"),o=t(e.selector_notify_button),n=t(e.selector_notify_content),i=t(e.selector_notify_counter))}};t.fn.notifyCenter=function(e){return u.loadProperties(),a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" not found in jQuery.notifyCenter "):a.init.apply(this,arguments)}}(jQuery);